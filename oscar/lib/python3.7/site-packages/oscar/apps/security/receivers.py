from django.db.models import F

from oscar.apps.basket.signals import security_addition, security_removal


def track_security_addition(basket, security, **kwargs):
    security.num_basket_additions += 1
    security.__class__._default_manager.filter(pk=security.pk).update(
        num_basket_additions=F('num_basket_additions') + 1,
    )


def track_security_removal(basket, security, **kwargs):
    security.num_basket_additions -= 1
    security.__class__._default_manager.filter(pk=security.pk).update(
        num_basket_additions=F('num_basket_additions') - 1,
    )


security_addition.connect(track_security_addition)
security_removal.connect(track_security_removal)
